<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-N3KHGCH7');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDAP Lookup</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center p-6">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N3KHGCH7"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h1 class="text-3xl font-bold mb-6">🔎 RDAP Lookup</h1>

    <div class="flex gap-2 w-full max-w-lg">
        <input type="text" id="domainInput" class="px-4 py-2 w-full rounded-md bg-gray-800 text-white border border-gray-700 focus:outline-none"
            placeholder="Enter domain (example.com)">
        <button onclick="lookupRDAP()" 
            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition">Search</button>
    </div>

    <div id="loading" class="mt-4 text-gray-400 hidden">🔄 Searching...</div>

    <div id="resultContainer" class="mt-6 w-full max-w-2xl bg-gray-800 p-4 rounded-lg hidden">
        <h2 class="text-xl font-semibold mb-2">Domain Information</h2>
        
        <p><strong>Domain:</strong> <span id="domainName">N/A</span></p>
        <p><strong>Registrar:</strong> <span id="registrar">N/A</span></p>
        <p><strong>Created:</strong> <span id="createdDate">N/A</span></p>
        <p><strong>Expires:</strong> <span id="expiresDate">N/A</span></p>
        <p><strong>Status:</strong> <span id="status">N/A</span></p>
        <p><strong>Nameservers:</strong> <span id="nameservers">N/A</span></p>

        <!-- Collapsible Raw JSON -->
        <button onclick="toggleRawJSON()" class="mt-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md">🔽 Show Raw JSON</button>

        <pre id="rawJsonContainer" class="mt-4 p-4 bg-gray-700 rounded-lg overflow-auto text-sm hidden"></pre>
    </div>

    <div id="errorContainer" class="mt-4 text-red-500 hidden"></div>

    <script>
        async function lookupRDAP() {
            const API_URL = "https://icann-whois.melisasavich.workers.dev/api/rdap";
            const domain = document.getElementById("domainInput").value;

            if (!domain) {
                alert("Please enter a domain!");
                return;
            }

            document.getElementById("loading").classList.remove("hidden");
            document.getElementById("resultContainer").classList.add("hidden");
            document.getElementById("errorContainer").classList.add("hidden");

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ domain })
                });

                if (!response.ok) throw new Error("API request failed");

                const data = await response.json();
                displayResult(data);
            } catch (error) {
                document.getElementById("errorContainer").textContent = "❌ Error fetching data: " + error.message;
                document.getElementById("errorContainer").classList.remove("hidden");
            } finally {
                document.getElementById("loading").classList.add("hidden");
            }
        }

        function displayResult(data) {
            document.getElementById("domainName").textContent = data.ldhName || "N/A";
            document.getElementById("registrar").textContent = data.entities?.[0]?.vcardArray?.[1]?.[1]?.[3] || "Unknown";
            document.getElementById("createdDate").textContent = formatDate(getEventDate(data, "registration"));
            document.getElementById("expiresDate").textContent = formatDate(getEventDate(data, "expiration"));
            document.getElementById("status").textContent = data.status?.join(", ") || "N/A";
            document.getElementById("nameservers").textContent = data.nameservers?.map(ns => ns.ldhName).join(", ") || "N/A";

            document.getElementById("rawJsonContainer").textContent = JSON.stringify(data, null, 2);
            document.getElementById("resultContainer").classList.remove("hidden");
        }

        function getEventDate(data, eventAction) {
            return data.events?.find(e => e.eventAction === eventAction)?.eventDate || "N/A";
        }

        function formatDate(dateString) {
            if (dateString === "N/A") return "N/A";
            return new Date(dateString).toLocaleDateString();
        }

        function toggleRawJSON() {
            document.getElementById("rawJsonContainer").classList.toggle("hidden");
        }
    </script>
</body>
</html>

